!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.DzhyunDataParser=e():r.DzhyunDataParser=e()}(this,function(){return function(r){function e(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return r[t].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=r,e.c=n,e.i=function(r){return r},e.d=function(r,n,t){e.o(r,n)||Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:t})},e.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(n,"a",n),n},e.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},e.p="",e(e.s=4)}([function(r,e,n){"use strict";function t(r){for(var e=r.length,n=new ArrayBuffer(2*e),t=new Uint8Array(n),o=0;o<e;o+=1)t[o]=r.charCodeAt(o);return n}function o(r){if(u)return u.decode(new Uint8Array(r));var e=new Uint8Array(r),n=e.length;if(n>i){var t=[],o=0;do{var a=e.subarray(o,o+=i);t.push(String.fromCharCode.apply(String,a))}while(o<n);return decodeURIComponent(escape(t.join("")))}return decodeURIComponent(escape(String.fromCharCode.apply(String,e)))}Object.defineProperty(e,"__esModule",{value:!0}),e.stringToArrayBuffer=t,e.arrayBufferToString=o;var u="undefined"!=typeof TextDecoder?new TextDecoder:void 0,a="undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts,i=a?32767.5:65535},function(r,e,n){"use strict"},function(r,e,n){"use strict";function t(r,e,n){return e in r?Object.defineProperty(r,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[e]=n,r}function o(r){if(!r||!r.head)return r;var e=r.head;return r.data.map(function(r){var n={};return r.forEach(function(r,t){n[e[t]]=o(r)}),n})}function u(r){return Promise.resolve().then(function(){var e="undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?(0,a.arrayBufferToString)(r):r,n=JSON.parse(e);if(0!==n.Err)return n;var u=n.Data;if(u.JsonTbl){var i=o(u.JsonTbl),f=Object.keys(i[0])[0],s=i[0][f];u=t({Id:u.Id},f,s)}return{Qid:n.Qid,Err:n.Err,Counter:n.Counter,Data:u}})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=u;var a=n(0)},function(r,e,n){"use strict";function t(r){if(!(r instanceof ArrayBuffer))throw new TypeError("Argument compressed must be type of ArrayBuffer");var e=new o.SnappyDecompressor(new Uint8Array(r)),n=e.readUncompressedLength();if(-1===n)throw new Error("Invalid Snappy bitstream");var t=new ArrayBuffer(n),u=new Uint8Array(t);if(!e.uncompressToBuffer(u))throw new Error("Invalid Snappy bitstream");return t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;var o=n(5)},function(r,e,n){"use strict";function t(r){return r&&r.__esModule?r:{default:r}}function o(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var u=function(){function r(r,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}(),a=n(3),i=t(a),f=n(1),s=t(f),c=n(2),p=t(c),d=n(0),l=function(){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,r),this.options=e}return u(r,[{key:"parse",value:function(e){var n=this;return Promise.resolve().then(function(){return"snappy"===n.options.compresser?r.uncompress(e):e}).then(function(e){return r.isJSON(e)?r.parseJSON(e):void 0===n.options.compresser?r.parseProtoBuf(e,!1!==n.options.yfloat).catch(function(t){return r.uncompress(e).catch(function(){throw t}).then(n.parse.bind(n))}):r.parseProtoBuf(e,!1!==n.options.yfloat)})}}],[{key:"parseProtoBuf",value:function(r,e){return"function"==typeof s.default?(0,s.default)(r,e):Promise.reject(new Error("no support parse protobuf data"))}},{key:"parseJSON",value:function(r){return"function"==typeof p.default?(0,p.default)(r):Promise.reject(new Error("no support parse JSON data"))}},{key:"isJSON",value:function(r){var e=void 0;return"string"==typeof r?e=r.charCodeAt(0):r instanceof ArrayBuffer&&(e=new Uint8Array(r)[0]),123===e}},{key:"uncompress",value:function(r){return Promise.resolve().then(function(){var e=r;if("function"!=typeof i.default)throw new Error("no support snappy uncompress");return"string"==typeof r?(e=(0,d.stringToArrayBuffer)(e),e=(0,i.default)(e)):e=(0,i.default)(e),e})}}]),r}();r.exports=l},function(r,e,n){"use strict";function t(r,e,n,t,o){var u;for(u=0;u<o;u++)n[t+u]=r[e+u]}function o(r,e,n,t){var o;for(o=0;o<t;o++)r[e+o]=r[e-n+o]}function u(r){this.array=r,this.pos=0}var a=[0,255,65535,16777215,4294967295];u.prototype.readUncompressedLength=function(){for(var r,e,n=0,t=0;t<32&&this.pos<this.array.length;){if(r=this.array[this.pos],this.pos+=1,(e=127&r)<<t>>>t!==e)return-1;if(n|=e<<t,r<128)return n;t+=7}return-1},u.prototype.uncompressToBuffer=function(r){for(var e,n,u,i,f=this.array,s=f.length,c=this.pos,p=0;c<f.length;)if(e=f[c],c+=1,0==(3&e)){if((n=1+(e>>>2))>60){if(c+3>=s)return!1;u=n-60,n=f[c]+(f[c+1]<<8)+(f[c+2]<<16)+(f[c+3]<<24),n=1+(n&a[u]),c+=u}if(c+n>s)return!1;t(f,c,r,p,n),c+=n,p+=n}else{switch(3&e){case 1:n=4+(e>>>2&7),i=f[c]+(e>>>5<<8),c+=1;break;case 2:if(c+1>=s)return!1;n=1+(e>>>2),i=f[c]+(f[c+1]<<8),c+=2;break;case 3:if(c+3>=s)return!1;n=1+(e>>>2),i=f[c]+(f[c+1]<<8)+(f[c+2]<<16)+(f[c+3]<<24),c+=4}if(0===i||i>p)return!1;o(r,p,i,n),p+=n}return!0},e.SnappyDecompressor=u}])});